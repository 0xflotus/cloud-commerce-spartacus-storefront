<ng-container *ngIf="!isWritingReview; else writeReview">
    <div class="product-reviews-tab-head">
        <div class="col-auto mr-auto">
            <h3>Overall Rating</h3>
            <y-star-rating [rating]="product.averageRating" [disabled]="true"></y-star-rating>
        </div>
        <div class="col-auto">
            <button class="btn btn-primary" (click)="initiateWriteReview()">Write a Review</button>
        </div>
    </div>
    <ng-container *ngIf="!isWritingReview; else writeReview">
        <ng-container *ngIf="reviews$ | async as reviews">
            <div class="review" *ngFor="let review of (reviews | slice:0:maxListItems)">
                <div class="review-details">
                    <h5>{{review.headline}}</h5>
                    <div class="row">
                        <div class="col-auto mr-auto">
                            <y-star-rating [rating]="review.rating" [disabled]="true"></y-star-rating>
                        </div>
                        <div class="col-auto">{{review.date | date}}</div>
                    </div>
                </div>
                <p class="review-text"> {{review.comment}} </p>
                <span class="review-name">
                    {{review.alias? review.alias : review.principal?.name}}
                </span>
            </div>
            <a (click)="maxListItems = reviews.length" *ngIf="maxListItems === initialMaxListItems">More</a>
            <a (click)="maxListItems = initialMaxListItems" *ngIf="maxListItems !== initialMaxListItems">Less</a>
        </ng-container>
    </ng-container>
</ng-container>

<ng-template #writeReview>
    <form [formGroup]="reviewForm" (ngSubmit)="submitReview()">
        <div class="form-group">
            <label for="reviewTitle">Review Title</label>
            <input type="text" class="form-control" id="reviewTitle" aria-describedby="reviewTitle" formControlName='title'>
        </div>
        <div class="form-group">
            <label for="reviewComments">Write your comments</label>
            <textarea class="form-control" id="reviewComments" rows="3" formControlName='comment'></textarea>
        </div>
        <div class="form-group">
            <label for="reviewComments">Rating</label>
            <y-star-rating formControlName="rating" [steps]="0.5"></y-star-rating>
        </div>
        <div class="form-group">
            <label for="reviewerName">Reviewer name (optional)</label>
            <input type="text" class="form-control" id="reviewerName" formControlName='reviewerName' aria-describedby="reviewTitle">
        </div>
        <div class="form-group row">
            <div class="col-12 col-md-4">
                <button type="submit" class="btn btn-block btn-secondary" (click)="cancelWriteReview()">Cancel</button>
            </div>
            <div class="col-12 col-md-4">
                <button type="submit" class="btn btn-block btn-primary" [ngClass]="{'submit-btn': reviewForm.valid}"
                    [disabled]="!reviewForm.valid">Summit</button>
            </div>
        </div>
    </form>
</ng-template>